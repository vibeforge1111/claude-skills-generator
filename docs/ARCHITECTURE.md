# Architecture Document

> Generated by VibeShip Orchestrator

---

## System Overview

Claude Skills Generator is a CLI tool built with Node.js that helps create, validate, test, and improve Claude Code skills.

```
┌─────────────────────────────────────────────────────────────────┐
│                         CLI Interface                            │
│  skill new | edit | validate | test | improve | suggest | train │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        Core Services                             │
├─────────────┬─────────────┬─────────────┬─────────────┬─────────┤
│   Skill     │  Validator  │  Playground │   Trainer   │   MCP   │
│  Generator  │   Engine    │   Runner    │   Service   │ Manager │
└─────────────┴─────────────┴─────────────┴─────────────┴─────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      External Integrations                       │
├─────────────────┬─────────────────┬─────────────────────────────┤
│   Claude API    │  YouTube API    │      File System            │
│  (Anthropic)    │  (Transcripts)  │   (.claude/skills/)         │
└─────────────────┴─────────────────┴─────────────────────────────┘
```

---

## Project Structure

```
skills-generator/
├── bin/
│   └── skill.js              # CLI entry point (#!/usr/bin/env node)
│
├── src/
│   ├── cli/
│   │   ├── index.js          # Command router
│   │   ├── commands/
│   │   │   ├── new.js        # skill new
│   │   │   ├── edit.js       # skill edit
│   │   │   ├── validate.js   # skill validate
│   │   │   ├── test.js       # skill test
│   │   │   ├── improve.js    # skill improve
│   │   │   ├── suggest.js    # skill suggest
│   │   │   ├── train.js      # skill train
│   │   │   ├── list.js       # skill list
│   │   │   ├── import.js     # skill import
│   │   │   ├── export.js     # skill export
│   │   │   └── mcps.js       # skill mcps
│   │   └── prompts/
│   │       └── wizard.js     # Interactive prompts
│   │
│   ├── services/
│   │   ├── generator/
│   │   │   ├── index.js      # Skill generation orchestrator
│   │   │   ├── templates.js  # Template management
│   │   │   └── ai-writer.js  # AI-assisted content generation
│   │   │
│   │   ├── validator/
│   │   │   ├── index.js      # Validation orchestrator
│   │   │   ├── schema.js     # JSON Schema validation
│   │   │   ├── quality.js    # Quality scoring
│   │   │   ├── ai-review.js  # Claude-powered review
│   │   │   └── tokens.js     # Token counting
│   │   │
│   │   ├── playground/
│   │   │   ├── index.js      # Test runner orchestrator
│   │   │   ├── sandbox.js    # Isolated execution environment
│   │   │   └── prompts.js    # Test prompt generation
│   │   │
│   │   ├── trainer/
│   │   │   ├── index.js      # Training orchestrator
│   │   │   ├── youtube.js    # YouTube transcript extraction
│   │   │   └── merger.js     # Knowledge merging into skills
│   │   │
│   │   ├── mcp/
│   │   │   ├── index.js      # MCP management orchestrator
│   │   │   ├── detector.js   # Detect required MCPs
│   │   │   └── config.js     # Generate MCP configs
│   │   │
│   │   └── context/
│   │       ├── index.js      # Project context analyzer
│   │       └── scanner.js    # Tech stack detection
│   │
│   ├── lib/
│   │   ├── claude.js         # Claude API wrapper
│   │   ├── filesystem.js     # Skill file operations
│   │   ├── parser.js         # SKILL.md parser (frontmatter + md)
│   │   └── logger.js         # Colored console output
│   │
│   ├── schemas/
│   │   └── skill.schema.json # JSON Schema for SKILL.md validation
│   │
│   └── templates/
│       ├── basic.md          # Basic skill template
│       ├── debugging.md      # Debugging skill template
│       ├── document.md       # Document processing template
│       ├── api.md            # API integration template
│       └── _partials/
│           ├── error-handling.md
│           ├── examples.md
│           └── mcp-section.md
│
├── package.json
├── README.md
└── .env.example              # API keys template
```

---

## Core Components

### 1. CLI Interface (`src/cli/`)

**Technology:** Commander.js + Inquirer.js + Chalk

```javascript
// bin/skill.js
#!/usr/bin/env node
import { program } from 'commander';
import { newCommand } from '../src/cli/commands/new.js';
import { validateCommand } from '../src/cli/commands/validate.js';
// ... other commands

program
  .name('skill')
  .description('Claude Skills Generator')
  .version('1.0.0');

program
  .command('new [name]')
  .description('Create a new skill with AI assistance')
  .option('-t, --template <type>', 'template to use')
  .option('--no-ai', 'skip AI assistance')
  .action(newCommand);

// ... register other commands

program.parse();
```

### 2. Generator Service (`src/services/generator/`)

**Responsibilities:**
- Template selection and customization
- AI-assisted content generation
- Project context integration
- Skill file creation

**Flow:**
```
User Input → Template Selection → Context Scan → AI Generation → File Write
```

### 3. Validator Service (`src/services/validator/`)

**Validation Layers:**

| Layer | What it checks | Technology |
|-------|---------------|------------|
| Schema | Required fields, structure | Ajv (JSON Schema) |
| Quality | Completeness, clarity, examples | Custom scoring algorithm |
| AI Review | Effectiveness, gaps, suggestions | Claude API |
| Tokens | Size limits, progressive disclosure | tiktoken |

**Quality Scoring Algorithm:**
```javascript
const qualityScore = {
  hasPurpose: 10,           // Clear purpose section
  hasWhenToUse: 10,         // Trigger conditions defined
  hasInstructions: 20,      // Detailed instructions
  hasExamples: 20,          // Usage examples
  hasErrorHandling: 15,     // Error cases covered
  hasReferences: 5,         // Links to resources
  tokenEfficiency: 10,      // Not too verbose
  clarity: 10               // AI-assessed clarity
};
// Total: 100 points
```

### 4. Playground Service (`src/services/playground/`)

**Purpose:** Test skills before deployment

**How it works:**
1. Load skill into isolated context
2. Generate test prompts based on skill triggers
3. Run prompts through Claude with skill loaded
4. Analyze responses for skill adherence
5. Report results + improvement suggestions

```javascript
// Simplified playground flow
async function testSkill(skillName) {
  const skill = await loadSkill(skillName);
  const testPrompts = generateTestPrompts(skill);

  const results = [];
  for (const prompt of testPrompts) {
    const response = await claude.chat({
      system: skill.content,
      messages: [{ role: 'user', content: prompt }]
    });
    results.push(analyzeResponse(response, skill));
  }

  return {
    passed: results.filter(r => r.passed).length,
    total: results.length,
    suggestions: generateSuggestions(results)
  };
}
```

### 5. Trainer Service (`src/services/trainer/`)

**YouTube Integration:**
```javascript
import { YoutubeTranscript } from 'youtube-transcript';

async function extractTranscript(url) {
  const videoId = extractVideoId(url);
  const transcript = await YoutubeTranscript.fetchTranscript(videoId);
  return transcript.map(t => t.text).join(' ');
}

async function trainSkill(skillName, youtubeUrl) {
  const transcript = await extractTranscript(youtubeUrl);
  const knowledge = await claude.extract({
    prompt: `Extract actionable techniques from this transcript for a ${skillName} skill...`,
    content: transcript
  });
  await mergeKnowledge(skillName, knowledge);
}
```

### 6. MCP Manager (`src/services/mcp/`)

**Responsibilities:**
- Detect required MCPs from skill content
- Generate MCP config snippets
- Provide installation instructions

**MCP Config Output:**
```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@anthropic/mcp-server-filesystem", "/path"]
    },
    "browser-tools": {
      "command": "npx",
      "args": ["-y", "@anthropic/mcp-server-puppeteer"]
    }
  }
}
```

---

## Data Models

### Skill File (SKILL.md)

```yaml
---
# Frontmatter (YAML)
name: string              # Required: skill identifier
description: string       # Required: for discovery
version: string           # Semver
author: string            # Creator
mcps:
  required: string[]      # Must-have MCPs
  optional: string[]      # Nice-to-have MCPs
triggers: string[]        # When to activate
tags: string[]            # Categorization
---

# Body (Markdown)
[Skill content following standard sections]
```

### Validation Result

```typescript
interface ValidationResult {
  valid: boolean;
  schema: {
    passed: boolean;
    errors: string[];
  };
  quality: {
    score: number;        // 0-100
    breakdown: Record<string, number>;
    suggestions: string[];
  };
  aiReview: {
    summary: string;
    strengths: string[];
    gaps: string[];
    suggestions: string[];
  };
  tokens: {
    count: number;
    withinLimit: boolean;
    progressiveDisclosure: boolean;
  };
}
```

### Test Result

```typescript
interface TestResult {
  skillName: string;
  testsRun: number;
  passed: number;
  failed: number;
  results: {
    prompt: string;
    response: string;
    activated: boolean;
    followedInstructions: boolean;
    notes: string[];
  }[];
  suggestions: string[];
}
```

---

## External Dependencies

### NPM Packages

```json
{
  "dependencies": {
    "@anthropic-ai/sdk": "^0.24.0",     // Claude API
    "commander": "^12.0.0",              // CLI framework
    "inquirer": "^9.2.0",                // Interactive prompts
    "chalk": "^5.3.0",                   // Colored output
    "ora": "^8.0.0",                     // Spinners
    "yaml": "^2.4.0",                    // YAML parsing
    "gray-matter": "^4.0.3",             // Frontmatter parsing
    "ajv": "^8.12.0",                    // JSON Schema validation
    "youtube-transcript": "^1.2.0",      // YouTube transcripts
    "glob": "^10.3.0",                   // File pattern matching
    "tiktoken": "^1.0.0"                 // Token counting
  },
  "devDependencies": {
    "vitest": "^1.0.0",                  // Testing
    "eslint": "^8.0.0"                   // Linting
  }
}
```

### External APIs

| API | Purpose | Auth Required |
|-----|---------|---------------|
| Claude (Anthropic) | AI generation, review, testing | API Key |
| YouTube Transcript | Video transcripts | None (public) |

---

## Configuration

### Environment Variables

```bash
# .env
ANTHROPIC_API_KEY=sk-ant-...      # Required for AI features
SKILLS_DIR=.claude/skills          # Default skills directory
DEFAULT_TEMPLATE=basic             # Default template for new skills
```

### Config File (optional)

```json
// .skillrc.json
{
  "skillsDir": ".claude/skills",
  "defaultTemplate": "basic",
  "validation": {
    "minQualityScore": 70,
    "maxTokens": 5000
  },
  "ai": {
    "model": "claude-sonnet-4-20250514",
    "maxTokens": 4096
  }
}
```

---

## Key Design Decisions

| Decision | Rationale |
|----------|-----------|
| Node.js runtime | Cross-platform, excellent CLI ecosystem, familiar to JS devs |
| Commander.js for CLI | Most mature CLI framework, good subcommand support |
| Inquirer.js for prompts | Best interactive prompt library, supports complex flows |
| Ajv for validation | Fastest JSON Schema validator, good error messages |
| Claude for AI | Direct integration with the platform we're building for |
| Folder-based skills | Matches community standard, supports resources/scripts |
| YAML frontmatter | Human-readable metadata, easy to parse |
| Layered validation | Catches issues at multiple levels, from syntax to effectiveness |

---

## Security Considerations

1. **API Key Storage** - Never commit keys, use .env files
2. **Skill Execution** - Playground runs in isolated context
3. **YouTube Fetching** - Only transcripts, no video download
4. **File System** - Sandboxed to skills directory by default
5. **User Confirmation** - AI changes require explicit approval

---

## Testing Strategy

| Level | What | Tool |
|-------|------|------|
| Unit | Individual functions | Vitest |
| Integration | Service interactions | Vitest |
| E2E | Full CLI commands | Vitest + exec |
| Manual | Real skill creation | Dogfooding |

---

## Performance Considerations

1. **Caching** - Cache Claude responses for repeated validations
2. **Streaming** - Stream long AI responses for better UX
3. **Parallel** - Run independent validations in parallel
4. **Lazy Loading** - Only load services when needed
